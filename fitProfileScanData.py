#!/usr/bin/env python

import sys
sys.path.append('cfg/')
import sys
sys.path.append('cfg/')
from frameworkStructure import pathes
sys.path.append(pathes.basePath)
print sys.path
import ROOT
ROOT.PyConfig.IgnoreCommandLineOptions = True
ROOT.gROOT.SetBatch(True)
from ROOT import gROOT, gStyle, TFile, TH2F, TH2D, TGraph, TCanvas
from setTDRStyle import setTDRStyle

from messageLogger import messageLogger as log
import dataInterface
import tools
import math
import argparse 

#from corrections import rSFOF, rEEOF, rMMOF

def getGraph():
        
        mlls =[ 27.1,27.1,30,32.9,35.8,38.7,41.6,44.5,47.4,50.3,53.2,56.1,59,61.9,64.8,67.7,70.6,73.5,76.4,79.3,82.2,85.1,88,90.9,93.8,96.7,99.6,102.5,105.4,108.3,111.2,114.1,117,119.9,122.8,125.7,128.6,131.5,134.4,137.3,140.2,143.1,146,148.9,151.8,154.7,157.6,160.5,163.4,166.3,169.2,172.1,175,177.9,180.8,183.7,186.6,189.5,192.4,195.3,198.2,201.1,204,206.9,209.8,212.7,215.6,218.5,221.4,224.3,227.2,230.1,233,235.9,238.8,241.7,244.6,247.5,250.4,253.3,256.2,259.1,262,264.9,267.8,270.7,273.6,276.5,279.4,282.3,285.2,288.1,291,293.9,296.8,299.7,302.6,305.5,308.4,311.3,314.2,317.1,320,320,322.9,322.9]
        
        #mc nominal
        # nlls =[0,0.1596357,0.1596357,0.1596439,0.1596412,0.159684,0.1596288,0.1596256,0.1599935,0.1596337,0.1596385,0.1596263,0.1596538,0.1596461,0.1596301,0.1596567,0.1596399,0.1596436,0.1596609,0.1596656,0.1596454,0.1596895,0.1595429,0.1215022,0.1417719,0.1600177,0.1596307,0.1596297,0.1596271,0.1596432,0.1596475,0.1259759,0.104998,0.09905211,0.06512123,0.02808853,0.001931271,0.04772938,0.07087602,0.1400843,0.1476252,0.1351631,0.1584102,0.159703,0.159631,0.1599167,0.1597473,0.1596366,0.1596738,0.1596266,0.1596374,0.1596274,0.1586561,0.149106,0.1494053,0.1512367,0.1536158,0.1532522,0.1590335,0.1483796,0.09394196,0.1102889,0.1463904,0.155622,0.1597452,0.1596315,0.1596361,0.1596272,0.1596622,0.1596437,0.1596318,0.1596351,0.1596722,0.1596262,0.1596903,0.1481016,0.1516163,0.1579032,0.1561912,0.1596109,0.1589518,0.1570932,0.1593331,0.1596361,0.1596703,0.1596886,0.1596266,0.1596384,0.1596403,0.1596371,0.1596346,0.1596304,0.1596417,0.1596447,0.1596392,0.1596346,0.1596264,0.1600124,0.1596512,0.1596772,0.1596993,0.1597348,0.1599141,0.1599141,0.1599141,0]
        
        #data cr
        # nlls =[0,3.82303,3.82303,3.823078,3.823376,3.823185,3.729816,2.92978,1.942044,0.8790216,0.3782704,0.1919417,0.9918079,1.357675,1.972184,2.212241,3.257687,3.71934,3.823002,3.817732,3.776759,3.793499,3.792578,3.702218,3.746985,3.81946,3.822977,3.822984,3.825471,3.822983,3.824931,3.822977,3.824258,3.824567,3.824511,3.824437,3.824965,3.822977,3.822977,3.823963,3.789404,3.729186,3.637908,3.470966,3.635074,3.726487,3.580805,3.512134,3.586279,3.672721,3.70109,3.770133,3.690511,3.608007,3.633102,3.576626,3.752251,3.787662,3.810687,3.803761,3.735355,3.818318,3.82299,3.826862,3.823045,3.822977,3.823064,3.823008,3.823023,3.822974,3.822974,3.822975,3.822979,3.823063,3.822974,3.822991,3.822974,3.822982,3.822983,3.823008,3.822987,3.823341,3.823159,3.823114,3.82321,3.822755,3.724699,3.71473,3.78224,3.814036,3.823022,3.821548,3.807841,3.807693,3.822981,3.82316,3.823245,3.82314,3.822985,3.823444,3.82303,3.82327,3.822993,3.822993,3.822993,0]
        
        #data sr
        # nlls = [0, 0.05683792,0.05683792,0.05675167,0.0568245,0.05674357,0.05676084,0.05672423,0.05687843,0.05697936,0.05703758,0.05712072,0.05672158,0.05672248,0.05678791,0.05684859,0.05674618,0.05676114,0.05673791,0.05676969,0.05671358,0.05672573,0.05680985,0.05681119,0.05676689,0.05684523,0.05688809,0.05685523,0.05683505,0.05683864,0.05683003,0.05682409,0.05681756,0.0567552,0.002695704,0.0567556,0.05679696,0.05682932,0.05677275,0.05675015,0.05672038,0.05566258,0.05182007,0.05658729,0.02388229,0.0128351,0.01861076,-0.1083216,-0.1486062,0.01528416,0.05671625,0.05672556,0.05674033,0.05675255,0.0567353,0.05674125,0.0567308,0.05349054,0.05688374,0.05670417,0.05673801,0.05672558,0.05673467,0.05671524,0.05672175,0.05672411,0.05674173,0.05674068,0.05672144,0.05672466,0.05676329,0.05690728,0.05674816,0.05682705,0.05667368,0.05683495,0.05686504,0.05674591,0.04756829,0.04927681,0.03250355,0.05329659,0.04819876,-0.06596075,-0.4155802,-0.2857607,-0.1800509,-0.3889334,-0.3002459,-0.4525476,-0.5179129,-0.504435,-0.4089775,-0.7286502,-0.5305559,-0.3693654,-0.416741,-0.3099354,-0.1649679,-0.02718474,-0.01823452,-0.0134743,-0.02397844,-0.02397844,-0.02397844,0]
        
        #data 2012 shape
        # nlls = [0,0.533805,0.533805,0.5338023,0.5335889,0.534197,0.5319276,0.5319189,0.5332905,0.5319725,0.5336905,0.5337628,0.5331973,0.5336814,0.5335485,0.5334814,0.5319158,0.5336329,0.5334565,0.5332098,0.5335779,0.5322182,0.5335252,0.5320723,0.5336339,0.5334224,0.5336398,0.5333542,0.5334022,0.5335796,0.5333505,0.5336431,0.5334729,0.5299246,0.4245329,0.5269348,0.533519,0.5333234,0.5013574,0.5317229,0.5332054,0.4668618,0.4937592,0.4759509,0.3925955,0.4209441,0.4305178,0.1575315,0.007799133,0.4374304,0.5333811,0.5334352,0.5332442,0.5332821,0.5333267,0.533387,0.5334774,0.523281,0.5324264,0.5335415,0.5332635,0.533546,0.5335808,0.5318793,0.5334743,0.5332072,0.5334583,0.5336462,0.5334281,0.5338291,0.5334332,0.5334592,0.5332326,0.5319063,0.5319456,0.5320828,0.5327163,0.5326512,0.5333013,0.5325628,0.5300222,0.5329513,0.5320359,0.4440867,0.1343599,0.2907001,0.4048386,0.2160239,0.3220531,0.1748886,-0.2029055,0.1430064,0.2446725,0.0110629,0.1513235,0.2436074,0.2392524,0.3156908,0.4185403,0.5061264,0.5117454,0.5135246,0.5056442,0.5056442,0.5056442,0]
        
        #data hist shape
        nlls = [0,23.26997,23.26997,23.26991,23.26996,23.26992,23.25835,23.2685,23.26994,23.26991,23.26996,23.26992,23.26992,23.26992,23.26992,23.26993,23.26996,23.26992,23.26994,23.27,23.26998,23.26994,23.26284,23.25746,23.26999,23.26994,23.26992,23.26994,23.26993,23.26993,23.26992,23.26993,22.09793,16.24992,14.96124,16.49013,16.88534,16.26961,14.85633,15.39802,16.35911,15.65804,15.76814,16.60798,16.01786,15.81483,16.21355,15.98321,16.44547,17.51873,18.85156,19.50053,19.66168,20.12851,20.07586,19.82463,18.66749,16.90187,17.28471,18.39916,19.40345,19.96653,18.82587,18.21922,17.60545,14.89949,17.38954,17.91499,17.7905,17.15875,17.94769,18.67623,19.13027,19.33471,19.38131,19.95813,19.44129,17.76471,17.05472,17.52851,17.84653,18.16327,17.24938,16.00911,15.53203,16.38012,16.94134,16.60773,17.02339,16.50859,15.76224,16.62129,16.92459,16.33853,16.71198,17.036,17.09686,17.55412,18.11722,18.61268,18.34584,18.70736,19.12936,19.12936,19.12936,0]
        
        from array import array
        arrx = array('f', mlls)
        arry = array('f', nlls)
        
        graph = ROOT.TGraph(len(mlls),arrx, arry)
        # graph = ROOT.TGraph(mlls, nlls)
        graph.SetName("Profile")
        graph.SetTitle("-log(L)")
        
        return graph



def plot():
        
        canv = TCanvas("canv", "canv",800,800)
        plotPad = ROOT.TPad("plotPad","plotPad",0,0,1,1)
        style=setTDRStyle()     
        #~ style.SetPadRightMargin(0.18)        
        plotPad.UseCurrentStyle()
        plotPad.Draw()  
        plotPad.cd()
        
        latex = ROOT.TLatex()
        latex.SetTextSize(0.035)
        latex.SetNDC(True)
        latexLumi = ROOT.TLatex()
        latexLumi.SetTextFont(42)
        latexLumi.SetTextAlign(31)
        latexLumi.SetTextSize(0.04)
        latexLumi.SetNDC(True)
        latexCMS = ROOT.TLatex()
        latexCMS.SetTextFont(61)
        latexCMS.SetTextSize(0.055)
        latexCMS.SetNDC(True)
        latexCMSExtra = ROOT.TLatex()
        latexCMSExtra.SetTextFont(52)
        latexCMSExtra.SetTextSize(0.03)
        latexCMSExtra.SetNDC(True)
        
        likelihoodGraph = getGraph()
        
        
        minL = likelihoodGraph.GetMinimum()
        
        
        nEntries = likelihoodGraph.GetN()
        
        xValues = likelihoodGraph.GetX()
        yValues = likelihoodGraph.GetY()
        
        plotGraph = ROOT.TGraph()
        
        minL = 1000
        
        for i in range(1,nEntries-1):
                if yValues[i] < minL:
                        minL = yValues[i]
        for i in range(1,nEntries-1):           
                #~ print str(xValues[i])+": "+str(yValues[i]-minL)
                plotGraph.SetPoint(i-1,xValues[i],yValues[i]-minL)
        
        plotGraph.SetLineWidth(2)
        plotGraph.SetLineColor(2)
        # print plotGraph.GetMaximum()
        
        # fr = plotPad.DrawFrame(35,0,320,1,"; m_{ll}^{edge} [GeV]; log(L) - log(L_{min})")
        fr = plotPad.DrawFrame(35,0,320,10,"; m_{ll}^{edge} [GeV]; log(L) - log(L_{min})")
        fr.GetYaxis().SetTitleOffset(1.1)
        latexLumi.DrawLatex(0.95, 0.96, "137 fb^{-1} (13 TeV)")
        latexCMS.DrawLatex(0.19,0.88,"CMS")
        # latexCMSExtra.DrawLatex(0.19,0.83,"#splitline{Private Work}{Simulation}")
        latexCMSExtra.DrawLatex(0.19,0.84,"Private Work")
        
        plotGraph.Draw("same c")
        
        canv.Update()
        canv.Print("ProfileScanData_datahistSR.pdf")
        
        
        

if (__name__ == "__main__"):
    plot()
